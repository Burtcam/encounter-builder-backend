<!doctype html>
<html lang="en" x-data="todoApp()" x-init="fetchTodos()">
<head>
  <meta charset="utf-8">
  <title>Alpine + Go Todo</title>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    ul { list-style: none; padding: 0; }
    li + li { margin-top: .5rem; }
  </style>
</head>
<body>
  <h1>Monsters</h1>

  <div>
    <input
      type="text"
      placeholder="New todoâ€¦"
      x-model="newText"
      @keydown.enter="addTodo()"
    />
    <button @click="addTodo()">Add</button>
  </div>

  <template x-if="todos.length === 0">
    <p>No todos yet.</p>
  </template>

  <ul>
    <template x-for="todo in todos" :key="todo.id">
      <li x-text="todo.text"></li>
    </template>
  </ul>

  <script>
    function todoApp() {
      return {
        todos: [],
        newText: '',

        // load on page load
        async fetchTodos() {
          const res = await fetch('/api/todos')
          this.todos = await res.json()
        },

        // post new todo
        async addTodo() {
          if (!this.newText.trim()) return
          const res = await fetch('/api/todos', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: this.newText })
          })
          if (res.ok) {
            const todo = await res.json()
            this.todos.push(todo)
            this.newText = ''
          } else {
            console.error('failed to add')
          }
        }
      }
    }
  </script>
</body>
</html>